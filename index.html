<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>HitPoints Mini App</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#121212;
            --card:#1e1e1e;
            --muted:#b0b0b0;
            --accent:#e8ff3b; /* neon-ish */
            --text:#e0e0e0;
        }
        *{box-sizing:border-box}
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        /* =========== TOP AREA =========== */
        .top-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
        }

        /* Title row (separate) */
        .title-row {
            display:flex;
            align-items:center;
            justify-content:flex-start;
        }
        .app-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
            text-align: left;
            padding-left: 4px;
        }

        /* Row with address + plus on the same line */
        .address-row {
            display:flex;
            align-items:center;
            gap:12px;
        }
        .address-card {
            background: var(--card);
            border-radius: 14px;
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.02);
            cursor: pointer;
        }
        .addr-square {
            width:14px; height:14px; border-radius:3px; background: rgba(255,255,255,0.06); flex:0 0 14px;
        }
        .addr-square.selected { background: var(--accent); box-shadow: 0 0 0 4px rgba(232,255,59,0.06); }
        .addr-texts { display:flex; flex-direction:column; gap:4px; overflow:hidden; }
        .addr-line { font-weight:600; font-size:14px; color:var(--text); white-space:nowrap; text-overflow:ellipsis; overflow:hidden; }
        .addr-sub { font-size:12px; color:#9a9a9a; }

        /* plus button aligned to the same row as address */
        .add-address-btn {
            background: var(--accent);
            color: #111;
            width: 46px;
            height: 46px;
            border-radius: 12px;
            border: none;
            font-size: 28px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex: 0 0 46px;
            box-shadow: 0 6px 18px rgba(232,255,59,0.08);
        }

        /* tabs (kept compatible with existing JS) */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .tab {
            background: transparent;
            color: #b0b0b0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s, color 0.3s;
        }
        .tab:hover, .tab.active {
            background: #333;
            color: #e0e0e0;
        }

        /* =========== REST OF STYLES (kept) =========== */
        .category { 
            margin-bottom: 30px;
            display: none;
        }
        .category.active { display: block; }
        .category h2 { color: #27AE60; font-weight: 700; font-size: 28px; margin-bottom: 15px; }

        .items-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .item { background: transparent; box-shadow: none; padding: 0; text-align: center; }
        .item img { width: 100%; height: auto; aspect-ratio: 1 / 1; object-fit: cover; background: #fff; border-radius: 10px; margin-bottom: 10px; }
        .item h3 { margin: 0 0 5px; color: #e0e0e0; font-weight: 600; font-size: 16px; }
        .price-btn { background: #1e1e1e; color: #e0e0e0; border: none; font-size: 16px; font-weight: 600; cursor: pointer; padding: 10px 20px; border-radius: 20px; width: 100%; display: block; margin-top: 10px; transition: background 0.3s; }
        .price-btn:hover { background: #252525; }

        /* =========== BOTTOM SHEET (–Ω–æ–≤–∞—è –ø–∞–Ω–µ–ª—å) =========== */
        /* –∑–∞—Ç–µ–º–Ω—è—é—â–∏–π —Ñ–æ–Ω */
        #overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: none; /* –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å .open */
            z-index: 1000;
            -webkit-tap-highlight-color: transparent;
        }
        #overlay.open { display: block; }

        /* –ø–∞–Ω–µ–ª—å –≤—ã–µ–∑–∂–∞—é—â–∞—è —Å–Ω–∏–∑—É */
        #details {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            margin: 0 auto;
            width: 100%;
            max-width: 980px;
            background: #1e1e1e;
            border-radius: 16px 16px 0 0;
            box-shadow: 0 -8px 30px rgba(0,0,0,0.6);
            transform: translateY(100%);
            transition: transform 320ms cubic-bezier(.2,.8,.2,1);
            max-height: 85vh;
            overflow: auto;
            padding: 18px;
        }
        /* –∫–æ–≥–¥–∞ overlay –æ—Ç–∫—Ä—ã—Ç ‚Äî —Å–¥–≤–∏–≥–∞–µ–º –ø–∞–Ω–µ–ª—å –≤–≤–µ—Ä—Ö (–≤–∏–¥–Ω–∞) */
        #overlay.open #details {
            transform: translateY(0);
        }

        /* drag-handle (–≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞ —Å–≤–µ—Ä—Ö—É –ø–∞–Ω–µ–ª–∏) */
        .sheet-handle {
            width: 44px;
            height: 4px;
            background: rgba(255,255,255,0.06);
            border-radius: 4px;
            margin: 6px auto 14px auto;
        }

        #close-btn {
            position: absolute;
            top: 10px;
            right: 12px;
            background: transparent;
            color: #e0e0e0;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        #detail-image { width: 100%; height: auto; border-radius: 10px; margin-bottom: 16px; }
        #detail-name { color: #e0e0e0; font-weight: 700; font-size: 22px; margin-bottom: 8px; }
        #detail-desc { color: #b0b0b0; font-size: 15px; margin: 10px 0 14px 0; }

        /* nutrition: cubes in one line */
        #detail-nutrition { margin: 8px 0 12px 0; text-align: left; }
        #detail-nutrition h4 { color: #27AE60; font-size: 16px; margin: 0 0 8px 0; }
        .nutrition-grid { display: flex; justify-content:flex-start; align-items: stretch; gap: 10px; flex-wrap: nowrap; }
        .nutri-box { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.04); border-radius: 10px; padding: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 90px; min-width: 90px; min-height: 70px; box-shadow: 0 2px 6px rgba(0,0,0,0.6); }
        .nutri-value { font-weight: 700; font-size: 16px; color: #e0e0e0; line-height: 1; }
        .nutri-label { font-size: 11px; color: #9a9a9a; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

        #detail-additives { margin: 12px 0; }
        #detail-additives h4 { color: #27AE60; font-size: 16px; margin-bottom: 8px; }
        .additive { display: flex; justify-content: space-between; align-items: center; background: #252525; border-radius: 10px; padding: 10px; margin-bottom: 10px; }
        .additive label { flex: 1; color: #e0e0e0; }
        #detail-price { color: #27AE60; font-weight: 700; font-size: 18px; margin: 10px 0; }
        .counter { display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .minus, .plus { background: #444; color: #fff; border: none; width: 40px; height: 40px; border-radius: 8px; font-size: 22px; cursor: pointer; margin: 0 10px; }
        .qty { font-size: 20px; min-width: 28px; text-align: center; color:#fff; }

        /* responsive tweaks */
        @media (max-width:520px){
            body { padding:12px; }
            .app-title { font-size:18px; }
            .addr-line { font-size:13px; }
            .nutri-box { width:78px; min-width:78px; min-height:62px; padding:6px; }
            .nutri-value { font-size:14px; }
            .nutri-label { font-size:10px; }
            #details { padding: 14px; border-radius: 12px 12px 0 0; }
        }
    </style>
</head>
<body>

    <!-- TITLE -->
    <div class="top-area">
        <div class="title-row">
            <div class="app-title">HitPoints</div>
        </div>

        <!-- address + plus on same line -->
        <div class="address-row">
            <div id="main-address" class="address-card" role="button" title="–û—Ç–∫—Ä—ã—Ç—å –∞–¥—Ä–µ—Å–∞">
                <div class="addr-square" aria-hidden="true"></div>
                <div class="addr-texts">
                    <div class="addr-line" id="addr-line">–ö–∞–º–µ–Ω–Ω–æ–æ—Å—Ç—Ä–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 40</div>
                    <div class="addr-sub" id="addr-sub">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è</div>
                </div>
                <div class="addr-action" style="color:#9a9a9a; font-size:18px;">‚Ä∫</div>
            </div>

            <button id="add-address-top" class="add-address-btn" title="–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å">+</button>
        </div>

        <div class="tabs" id="tabs"></div>
    </div>

    <!-- MENU -->
    <div id="menu">
        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
    </div>

    <!-- BOTTOM SHEET OVERLAY -->
    <div id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
        <div id="details">
            <div class="sheet-handle" aria-hidden="true"></div>
            <button id="close-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>

            <img id="detail-image" src="" alt="">
            <h3 id="detail-name"></h3>
            <p id="detail-desc"></p>

            <!-- –ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å -->
            <div id="detail-nutrition">
                <h4>–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å</h4>
                <div class="nutrition-grid">
                    <div class="nutri-box">
                        <div class="nutri-value" id="detail-calories">0 –∫–∫–∞–ª</div>
                        <div class="nutri-label">–ö–∞–ª–æ—Ä–∏–∏</div>
                    </div>
                    <div class="nutri-box">
                        <div class="nutri-value" id="detail-proteins">0 –≥</div>
                        <div class="nutri-label">–ë–µ–ª–∫–∏</div>
                    </div>
                    <div class="nutri-box">
                        <div class="nutri-value" id="detail-fats">0 –≥</div>
                        <div class="nutri-label">–ñ–∏—Ä—ã</div>
                    </div>
                    <div class="nutri-box">
                        <div class="nutri-value" id="detail-carbs">0 –≥</div>
                        <div class="nutri-label">–£–≥–ª–µ–≤–æ–¥—ã</div>
                    </div>
                </div>
            </div>

            <div id="detail-additives">
                <h4>–î–æ–±–∞–≤–∫–∏</h4>
                <!-- –î–æ–±–∞–≤–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <p id="detail-price"></p>

            <div class="counter" id="detail-counter">
                <button class="minus" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">-</button>
                <span class="qty">0</span>
                <button class="plus" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
            </div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        /* === DATA & JS (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞) === */
        const menuData = {  
            '–®–ê–£–†–ú–ê': [
                {name: '–®–∞—É—Ä–º–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è', price: 300, desc: '–ö—É—Ä–∏—Ü–∞, –∫–∞–ø—É—Å—Ç–∞, —Ç–æ–º–∞—Ç—ã, –æ–≥—É—Ä—Ü—ã, –º–æ—Ä–∫–æ–≤—å –ø–æ-–∫–æ—Ä–µ–π—Å–∫–∏, –ª—É–∫, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å, –∑–µ–ª–µ–Ω—å.', calories: 550, proteins: 25, fats: 30, carbs: 45, image: 'https://thumbs.dreamstime.com/b/close-up-grilled-chicken-shawarma-wrap-vegetables-white-sauce-placed-rustic-wooden-board-warm-lighting-386359191.jpg'},
                {name: '–®–∞—É—Ä–º–∞ —Ñ—Ä–∏', price: 360, desc: '–ö—É—Ä–∏—Ü–∞, –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏, —Ç–æ–º–∞—Ç—ã, –æ–≥—É—Ä—Ü—ã, –º–æ—Ä–∫–æ–≤—å –ø–æ-–∫–æ—Ä–µ–π—Å–∫–∏, –ª—É–∫, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å, –∑–µ–ª–µ–Ω—å.', calories: 650, proteins: 28, fats: 35, carbs: 55, image: 'https://www.shutterstock.com/image-photo/meat-beef-shawarma-arabic-meal-260nw-2471431623.jpg'},
                {name: '–®–∞—É—Ä–º–∞ XXL', price: 430, desc: '–ö—É—Ä–∏—Ü–∞, –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏, —Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –º–æ—Ä–∫–æ–≤—å –ø–æ-–∫–æ—Ä–µ–π—Å–∫–∏, —Ç–æ–º–∞—Ç—ã, –æ–≥—É—Ä—Ü—ã, –ª—É–∫, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å, –∑–µ–ª–µ–Ω—å.', calories: 800, proteins: 35, fats: 40, carbs: 65, image: 'https://thumbs.dreamstime.com/b/shawarma-meat-vegetables-lies-wooden-table-background-shawarma-meat-vegetables-lies-wooden-table-162488416.jpg'},
            ],
            '–ë–£–†–ì–ï–†–´': [
                {name: '–ß–∏–∑–±—É—Ä–≥–µ—Ä', price: 380, desc: '–ì–æ–≤—è–∂—å—è –∫–æ—Ç–ª–µ—Ç–∞, –ª–∏—Å—Ç —Å–∞–ª–∞—Ç–∞, —Å—ã—Ä, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—á–∏–∫–∏, –ø–æ–º–∏–¥–æ—Ä—ã, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å.', calories: 700, proteins: 30, fats: 40, carbs: 50, image: 'https://external-preview.redd.it/X4Aa9z5flSaXtbq2NXn4uLGzK9Y2AhbvCmRr6tl30Q8.jpg?auto=webp&s=cb671afc9c2654af44304aa5e67a42a81a1e9b3c'},
                {name: '–ß–∏–∫–µ–Ω–±—É—Ä–≥–µ—Ä', price: 300, desc: '–ö—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, –ª–∏—Å—Ç —Å–∞–ª–∞—Ç–∞, —Å—ã—Ä, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—á–∏–∫–∏, –ø–æ–º–∏–¥–æ—Ä—ã, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å.', calories: 600, proteins: 28, fats: 35, carbs: 45, image: 'https://media.istockphoto.com/id/1273265655/photo/burger-with-fried-chicken-meat-isolated-on-white-background.jpg?s=612x612&w=0&k=20&c=iwDZMUYie0zldQBJY6vXjidTqw6rNKrSEnSPszXpJCI='},
            ],
            '–ü–ï–†–ï–ö–£–° / –§–†–ò': [
                {name: '–•–æ—Ç-–¥–æ–≥', price: 150, desc: '(–±—É–ª–æ—á–∫–∞, –≥–æ–≤—è–∂—å—è —Å–æ—Å–∏—Å–∫–∞, –º–æ—Ä–∫–æ–≤—å –ø–æ-–∫–æ—Ä–µ–π—Å–∫–∏, —Å–æ—É—Å)', calories: 400, proteins: 15, fats: 20, carbs: 35, image: 'https://www.mashed.com/img/gallery/these-12-hot-dogs-use-only-the-best-high-quality-ingredients/l-intro-1710886406.jpg'},
                {name: 'Mix-box', price: 350, desc: '(–∫—É—Ä–∏—Ü–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—á–∏–∫–∏, —Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —Å–æ—É—Å)', calories: 750, proteins: 30, fats: 40, carbs: 60, image: 'https://lookaside.fbsbx.com/lookaside/crawler/media/?media_id=10172692477035492'},
                {name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏', price: 150, desc: '', calories: 300, proteins: 5, fats: 15, carbs: 40, image: 'https://media.gettyimages.com/id/614420426/photo/basket-of-french-fries.jpg?s=612x612&w=gi&k=20&c=0xqKNm7b0f94TKAwR-99vkohcHkAppuXBVbLKNArY3A='},
                {name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–æ-–¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏', price: 150, desc: '', calories: 320, proteins: 6, fats: 16, carbs: 42, image: 'https://www.gonnawantseconds.com/wp-content/uploads/2022/11/Country-Potatoes-5.jpg'},
                {name: '–ù–∞–≥–≥–µ—Ç—Å—ã', price: 150, desc: '', calories: 280, proteins: 14, fats: 18, carbs: 20, image: 'https://t4.ftcdn.net/jpg/02/59/52/75/360_F_259527589_ZMn1jWZzZ8JZyPP9w2drkjnjFhL0nY9C.jpg'},
                {name: '–°–æ—É—Å (–ø–æ—Ä—Ü–∏—è)', price: 40, desc: '', calories: 100, proteins: 1, fats: 10, carbs: 5, image: 'https://img.freepik.com/free-photo/red-hot-chilli-sauce-tomato-ketchup-chilli-sauce-puree-with-chili-pepper-tomatoes-garlic-wooden-cutting-board-stone-surface-top-view_1150-44905.jpg?semt=ais_hybrid&w=740&q=80'},
            ],
            '–ì–û–†–Ø–ß–ò–ï –ù–ê–ü–ò–¢–ö–ò': [
                {name: '–ß–∞–π (–ø–∞–∫.)', price: 30, desc: '', calories: 0, proteins: 0, fats: 0, carbs: 0, image: 'https://img.freepik.com/free-photo/overturned-bowl-full-tea-leaves-spoon-cup-tea-tea-bags-board-marble_114579-58289.jpg?semt=ais_hybrid&w=740&q=80'},
                {name: '–ö–æ—Ñ–µ (–º–æ–ª–æ—Ç—ã–π –≤ —Ä–∞—Å—Ç.)', price: 60, desc: '', calories: 5, proteins: 0, fats: 0, carbs: 1, image: 'https://img.freepik.com/free-photo/tool-used-coffee-press-cup_23-2149878088.jpg?semt=ais_hybrid&w=740&q=80'},
                {name: '–ö–∞–∫–∞–æ', price: 120, desc: '', calories: 200, proteins: 5, fats: 10, carbs: 25, image: 'https://img.freepik.com/free-photo/high-angle-decoration-with-mug-hot-chocolate_23-2148312050.jpg?semt=ais_hybrid&w=740&q=80'},
                {name: '–°–ª–∏–≤–∫–∏ (–ø–æ—Ä—Ü.)', price: 20, desc: '', calories: 100, proteins: 1, fats: 10, carbs: 2, image: 'https://img.freepik.com/premium-vector/portion-whipped-cream-sour-cream-twisted-into-spiral-butter-wooden-bowl_1278344-10566.jpg?semt=ais_hybrid&w=740'},
            ],
            '–•–û–õ–û–î–ù–´–ï –ù–ê–ü–ò–¢–ö–ò': [
                {name: '–ö–æ–º–ø–æ—Ç', price: 80, desc: '', calories: 150, proteins: 0, fats: 0, carbs: 40, image: 'https://media.istockphoto.com/id/1668740688/photo/plum-compote-in-glass-saucepan-close-up-wooden-spoon.jpg?s=612x612&w=0&k=20&c=8rtFMUAgRDOi55gtyBi6Ga3He04bI4QQLAefadQxRg4='},
                {name: '–ú–æ–ª–æ—á–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å (–º–æ–ª–æ–∫–æ, –º–æ—Ä–æ–∂–µ–Ω–æ–µ, —Å–∏—Ä–æ–ø)', price: 250, desc: '', calories: 400, proteins: 8, fats: 15, carbs: 60, image: 'https://thumbs.dreamstime.com/b/chocolate-milkshake-tall-glass-dollop-whipped-cream-syrup-cherry-top-high-quality-photo-378834287.jpg'},
                {name: '–°–æ–∫', price: 60, desc: '', calories: 100, proteins: 1, fats: 0, carbs: 25, image: 'https://www.shutterstock.com/image-photo/delicious-array-fresh-fruit-juices-260nw-192709250.jpg'},
            ],
        };
        const additives = {  
            'korean_carrot': {name: '–ú–æ—Ä–∫–æ–≤—å –ø–æ-–∫–æ—Ä–µ–π—Å–∫–∏', price: 20},
            'jalapeno': {name: '–•–∞–ª–∞–ø–µ–Ω—å–æ', price: 20},
            'cheese': {name: '–°—ã—Ä', price: 50},
            'pickles': {name: '–û–≥—É—Ä—á–∏–∫–∏', price: 30},
            'beef_patty': {name: '–ö–æ—Ç–ª–µ—Ç–∞ –≥–æ–≤—è–∂—å—è', price: 150},
            'chicken_patty': {name: '–ö–æ—Ç–ª–µ—Ç–∞ –∫—É—Ä–∏–Ω–∞—è', price: 100},
            'spicy_sauce': {name: '–°–æ—É—Å (–æ—Å—Ç—Ä—ã–π)', price: 20},
        };

        let cart = {};
        let selectedAdditives = {};
        let categories = Object.keys(menuData);
        let currentKey = '';

        function renderTabs() {
            const tabsDiv = document.getElementById('tabs');
            tabsDiv.innerHTML = ''; // –æ—á–∏—â–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
            categories.forEach((cat, index) => {
                let tab = document.createElement('div');
                tab.className = 'tab' + (index === 0 ? ' active' : '');
                tab.textContent = cat;
                tab.onclick = () => showCategory(cat);
                tabsDiv.appendChild(tab);
            });
        }

        function showCategory(selectedCat) {
            document.querySelectorAll('.category').forEach(catDiv => {
                catDiv.classList.remove('active');
            });
            const id = `cat-${selectedCat.toLowerCase().replace(/ /g, '-')}`;
            const el = document.getElementById(id);
            if (el) el.classList.add('active');

            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent === selectedCat) tab.classList.add('active');
            });
        }

        function renderMenu() {
            const menuDiv = document.getElementById('menu');
            menuDiv.innerHTML = ''; //, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            for (let category in menuData) {
                let catDiv = document.createElement('div');
                catDiv.className = 'category';
                catDiv.id = `cat-${category.toLowerCase().replace(/ /g, '-')}`;
                catDiv.innerHTML = `<h2>${category}</h2>`;
                let gridDiv = document.createElement('div');
                gridDiv.className = 'items-grid';
                menuData[category].forEach((item, index) => {
                    let key = `${category}:${index}`;
                    let itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.setAttribute('data-name', item.name.toLowerCase());
                    itemDiv.innerHTML = `
                        <img src="${item.image}" alt="${item.name}">
                        <h3>${item.name}</h3>
                        <button class="price-btn" onclick="showDetails('${key}')">${item.price} —Ä</button>
                    `;
                    gridDiv.appendChild(itemDiv);
                });
                catDiv.appendChild(gridDiv);
                menuDiv.appendChild(catDiv);
            }
            const firstCat = document.querySelector('.category');
            if (firstCat) firstCat.classList.add('active');
        }

        /* show bottom sheet (–∑–∞–º–µ–Ω–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞) */
        const overlay = document.getElementById('overlay');
        const details = document.getElementById('details');

        function showDetails(itemKey) {
            selectedAdditives = {};
            currentKey = itemKey;
            let [cat, idx] = itemKey.split(':');
            let item = menuData[cat][parseInt(idx)];
            document.getElementById('detail-image').src = item.image;
            document.getElementById('detail-image').alt = item.name;
            document.getElementById('detail-name').textContent = item.name;
            document.getElementById('detail-desc').textContent = item.desc;

            document.getElementById('detail-calories').textContent = `${item.calories} –∫–∫–∞–ª`;
            document.getElementById('detail-proteins').textContent = `${item.proteins} –≥`;
            document.getElementById('detail-fats').textContent = `${item.fats} –≥`;
            document.getElementById('detail-carbs').textContent = `${item.carbs} –≥`;

            document.getElementById('detail-price').textContent = `${item.price} —Ä`;
            document.getElementById('detail-counter').setAttribute('data-key', itemKey);
            renderAdditives();
            updateItemUI(itemKey);

            // show bottom sheet
            overlay.classList.add('open');
            overlay.setAttribute('aria-hidden', 'false');
            // prevent background scrolling:
            document.documentElement.style.overflow = 'hidden';
            document.body.style.overflow = 'hidden';
        }

        function hideDetails() {
            // hide bottom sheet
            overlay.classList.remove('open');
            overlay.setAttribute('aria-hidden', 'true');
            document.documentElement.style.overflow = '';
            document.body.style.overflow = '';
        }

        function renderAdditives() {
            const additivesDiv = document.getElementById('detail-additives');
            additivesDiv.innerHTML = '<h4>–î–æ–±–∞–≤–∫–∏</h4>';
            for (let key in additives) {
                let additive = additives[key];
                let div = document.createElement('div');
                div.className = 'additive';
                div.innerHTML = `
                    <label><input type="checkbox" onchange="toggleAdditive('${key}', this.checked)"> ${additive.name}</label>
                    <span>+${additive.price} —Ä</span>
                `;
                additivesDiv.appendChild(div);
            }
        }

        function toggleAdditive(key, checked) {
            if (checked) {
                selectedAdditives[key] = 1;
            } else {
                delete selectedAdditives[key];
            }
            updatePrice();
        }

        function updatePrice() {
            if (!currentKey) return;
            let [cat, idx] = currentKey.split(':');
            let item = menuData[cat][parseInt(idx)];
            let total = item.price;
            for (let key in selectedAdditives) {
                total += additives[key].price * selectedAdditives[key];
            }
            document.getElementById('detail-price').textContent = `${total} —Ä`;
        }

        function changeQuantity(itemKey, delta) {
            if (!cart[itemKey]) cart[itemKey] = {quantity: 0, additives: {}};
            cart[itemKey].quantity = Math.max(0, cart[itemKey].quantity + delta);
            cart[itemKey].additives = {...selectedAdditives};
            updateCart();
            updateItemUI(itemKey);
        }

        function updateItemUI(itemKey) {
            const counter = document.getElementById('detail-counter');
            if (!counter || counter.getAttribute('data-key') !== itemKey) return;
            const qty = counter.querySelector('.qty');
            const minus = counter.querySelector('.minus');
            const quantity = cart[itemKey] ? cart[itemKey].quantity : 0;
            qty.textContent = quantity;
            minus.style.display = quantity > 0 ? 'inline-block' : 'none';
        }

        function updateCart() {
            let total = 0;
            for (let key in cart) {
                let [cat, idx] = key.split(':');
                let item = menuData[cat][parseInt(idx)];
                let itemTotal = item.price * cart[key].quantity;
                for (let addKey in cart[key].additives) {
                    itemTotal += additives[addKey].price * cart[key].additives[addKey] * cart[key].quantity;
                }
                total += itemTotal;
            }
            if (window.Telegram && Telegram.WebApp) {
                if (total > 0) {
                    Telegram.WebApp.MainButton.setText(`üõí ${total} —Ä`);
                    Telegram.WebApp.MainButton.show();
                } else {
                    Telegram.WebApp.MainButton.hide();
                }
            }
        }

        function searchMenu(value) {
            value = value.toLowerCase();
            document.querySelectorAll('.item').forEach(item => {
                item.style.display = item.getAttribute('data-name').includes(value) ? 'block' : 'none';
            });
        }

        // handlers
        document.getElementById('close-btn').onclick = hideDetails;
        document.querySelector('#detail-counter .minus').onclick = () => changeQuantity(currentKey, -1);
        document.querySelector('#detail-counter .plus').onclick = () => changeQuantity(currentKey, 1);

        // close when click outside panel
        overlay.addEventListener('click', (e) => {
            // if click directly on overlay (outside #details), close
            if (e.target === overlay) hideDetails();
        });
        // prevent clicks inside details from closing
        details.addEventListener('click', (e) => e.stopPropagation());

        // top-area interactions
        const addBtn = document.getElementById('add-address-top');
        if (addBtn) {
            addBtn.addEventListener('click', () => {
                const a = prompt('–î–æ–±–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å (–ø—Ä–∏–º–µ—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞, 10):', '');
                if (a) {
                    const line = document.getElementById('addr-line');
                    const sub  = document.getElementById('addr-sub');
                    if (line) line.textContent = a;
                    if (sub)  sub.textContent = '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è';
                }
            });
        }
        const mainAddr = document.getElementById('main-address');
        if (mainAddr) {
            mainAddr.addEventListener('click', () => {
                alert('–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∞–¥—Ä–µ—Å–æ–≤ ‚Äî –∑–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤.');
            });
        }

        // Telegram WebApp main button setup (safe checks)
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.MainButton.setParams({color: '#27AE60', text_color: '#ffffff'});
            Telegram.WebApp.MainButton.onClick(() => {
                Telegram.WebApp.sendData(JSON.stringify(cart));
                Telegram.WebApp.close();
            });
            Telegram.WebApp.expand();
        }

        // init
        renderTabs();
        renderMenu();
    </script>
</body>
</html>
